= Defining a schema
:Summary: How to define a schema for a TypeDB database.
:page-aliases: typedb::development/schema.adoc
:keywords: typedb, typeql, schema, define, undefine, type, rule
:pageTitle: Defining a schema
:experimental:

Before inserting any data into a database, we need to define its schema.
Schema consists of types and rules definitions.
For more information on types, see the xref:typedb::basics/data-model.adoc[data model] page.

== Define query

To define a schema for a new database, you can use a Define query, for example:

[#_example]
.Define query example
[,typeql]
----
define

credential sub attribute, value string;
full-name sub attribute, value string;
subject sub entity,
    abstract,
    owns credential;
user sub subject;
person sub user, owns full-name;
----

[#_how_to_run_a_define_query]
=== How to run a Define query

A Define query can be sent with any TypeDB client: TypeDB Studio, TypeDB Console, or language-specific drivers.
Select a TypeDB client below, and send the above query example, using the instructions provided below.

For more information on how to connect to TypeDB, open a session, and open a transaction, see the
xref:typedb::connecting/overview.adoc[] page.

[tabs]
====
Console::
+
--
. Connect to TypeDB.
. Open a `schema` session and `write` transaction to a new/empty database, for example:
+
[,bash]
----
transaction db1 schema write
----
. Copy-paste the <<_example,query example>> above and push btn:[Enter] *twice*.
. Commit the changes made in the transaction:
+
[,bash]
----
commit
----
--

Studio::
+
--
. xref:typedb::connecting/studio.adoc#_connect_to_typedb[Connect to TypeDB] and
xref:typedb::connecting/studio.adoc#_select_a_project_directory[select a project directory].
. Select a new/empty database from a drop-down list in the top toolbar next to the database icon
image:home::studio-icons/database.png[].
. Switch to the `schema` and `write` in the top toolbar's session and transaction type selectors.
. Create a new tab in TypeDB Studio text editor, copy-paste the <<_example,query example>> above.
. Execute the query by clicking on the btn:[Run Query] (image:home::studio-icons/run.png[]) button.
. Commit the changes with the btn:[Commit transaction] (image:home::studio-icons/commit.png[]) button.
--

Rust::
+
--
.Define schema query
[,rust]
----
let typeql_define_query = "define
                        credential sub attribute, value string;
                        full-name sub attribute, value string;
                        subject sub entity,
                            abstract,
                            owns credential;
                        user sub subject;
                        person sub user, owns full-name;";
tx.query().define(&typeql_define_query).resolve()?;
tx.commit().resolve()?;
----
--

Python::
+
--
.Define schema query
[,python]
----
typeql_define_query = "define" \
                    "credential sub attribute, value string; " \
                    "full-name sub attribute, value string; " \
                    "subject sub entity," \
                    "    abstract," \
                    "    owns credential;" \
                    "user sub subject;" \
                    "person sub user, owns full-name;"
transaction.query.define(typeql_define_query)
transaction.commit()
----
--

Java::
+
--
.Define schema query
[,java]
----
String typeqlDefineQuery = """
                        define
                        credential sub attribute, value string;
                        full-name sub attribute, value string;
                        subject sub entity,
                            abstract,
                            owns credential;
                        user sub subject;
                        person sub user, owns full-name;
                        """;
writeTransaction.query().define(typeqlDefineQuery);
writeTransaction.commit();
----
--

Node.js::
+
--
.Define schema query
[,js]
----
const typeql_define_query = `define
                            credential sub attribute, value string;
                            full-name sub attribute, value string;
                            subject sub entity,
                                abstract,
                                owns credential;
                            user sub subject;
                            person sub user, owns full-name;
                            `;
await transaction.query.define(typeql_define_query);
await transaction.commit();
----
--
====

[#_extend_a_schema]
== Extend a schema

Any existing schema can be extended by adding new types, new properties to existing types,
as well as adding new rules or replacing existing rules.
To extend an existing schema, just <<_how_to_run_a_define_query,run>>
a new Define query with new schema statements.

Since extending schema can't change existing types,
you can extend a schema of a database that already has data inserted.
Extending a schema doesn't require any updates to pre-existing data or queries.

Define queries are idempotent.
Hence, running the same statement in a Define query more than once produces the same result, as running it once.
You can send the above Define query example multiple times.
Alternatively, you can modify the above Define query example to extend the schema.
Pre-existing schema statements can't be duplicated in a schema, so only the extension will be applied.
For example, send the following Define query with the full
xref:typedb::tutorials/iam-schema.adoc[IAM schema] to the same database as before:

[,typeql]
----
include::typedb::attachment$iam-schema.tql[lines=17..]
----

The above query defines many types, some of which are partially defined by the <<_example,first example>>
and are being extended.
A Define query is validated for syntax and the resulted schema is validated for consistency.

For more information on defining types and rules in a schema, see the
xref:typeql::schema/define-types.adoc[]
and xref:typeql::schema/define-rules.adoc[] pages.

[#_truncate_a_schema]
== Truncate a schema

Any schema can be truncated by removing existing types, their properties, and existing rules with an
xref:typeql::schema/undefine.adoc[Undefine query].

To remove a statement about a type from a schema, use it in an Undefine query.

.Undefine example
[,typeql]
----
undefine

database owns name;
----

The above example removes the ability to own the `name` type attributes by the `database` type entities.
To remove the `database` entity type from a schema completely, use the following query:

.Undefine type example
[,typeql]
----
undefine

database sub resource-collection;
----

The above query removes the `database` type from a schema as long as `database` subtypes `resource-collection` type
directly or indirectly.
Deleting a type also removes all references of the type in a schema, e.g., owned attribute types and roles played.

[#_undefine_subtype]
[IMPORTANT]
====
To be able to undefine a type, it needs to have no subtypes in a schema and no data in a database.
====

For more information on how to undefine types, see the xref:typeql::schema/undefine.adoc[] page.

[#_undefine_rule]
=== Undefine a rule

To undefine a rule, use the following syntax:

[,typeql]
----
undefine

rule <rule-label>;
----

Undefining a rule does not require repeating its condition or conclusion.

== Delete a schema

You can remove all user-defined types and all rules.
But that also requires to delete all data from a database.
It is usually easier to just delete the whole database and create a new one with the same name.

== Rename a type

To rename a type, use the TypeDB Studio's xref:typedb:ROOT:connecting/studio.adoc#_type_editor[type editor]
or TypeDB driver API methods.
//#todo Add tabs with code snippets and links to API ref?

== Modify a rule

You can replace a rule with a new one by xref:typeql::schema/define-rules.adoc[defining a new rule]
with the same label as the old one.

== Learn more

After you defined a schema, you can xref:typedb::developing/write.adoc[write] some data to the database.

If you don't have your own schema ready yet, feel free to continue using the
https://github.com/vaticle/typedb-docs/blob/master/typedb-src/modules/ROOT/attachments/iam-schema.tql[IAM schema,window=_blank].
